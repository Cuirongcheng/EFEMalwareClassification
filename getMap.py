import os
import numpy as np
import cv2
from collections import *
import pandas as pd
import binascii

def getMapfrom_asm(filename):
    f = open(filename, 'rb')
    image = np.fromfile(f, dtype=np.ubyte)
    filesize = image.shape[0]
    print(filesize)
    width = 512 #设置图片宽度为512
    rem = filesize%width
    print(rem)
    if rem != 0:
        image = image[:-rem]
    height = int(image.shape[0]/width)
    image = image.reshape(height,width)

    return image


basepath = "F:\\big2015\\malware-classification\\train\\"
mapimg = defaultdict(list)
subtrain = pd.read_csv('trainLabels.csv')
i = 0
for sid in subtrain.Id:
    i += 1
    print("dealing with {0}th file...".format(str(i)))
    filename = basepath + sid + ".asm"
    im = getMapfrom_asm(filename)
    cv2.imwrite('F:\\big2015\\malware-classification\\train_img_asm\\%s.png'%(sid), im)
    filename_bytes = basepath + sid + ".bytes"
    im_bytes = getMapfrom_asm(filename_bytes)
    cv2.imwrite('F:\\big2015\\malware-classification\\train_img_bytes\\%s.png' % (sid), im_bytes)
    print("maping with {0}th image...".format(str(i)))
